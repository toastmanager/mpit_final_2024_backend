# MPIT FINAL 2024 | Backend

–°–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –≤ —Ä–∞–º–∫–∞—Ö —Ñ–∏–Ω–∞–ª–∞ —Ö–∞–∫–∞—Ç–æ–Ω–∞ –ú–æ—è –ø—Ä–æ—Ñ–µ—Å—Å–∏—è ‚Äì –ò–¢

## üìñ –°–æ–¥–µ–∂—Ä–∞–Ω–∏–µ

1. [üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏](#-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏)
2. [üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞](#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
3. [üíª –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
4. [üîß –ó–∞–ø—É—Å–∫](#-–∑–∞–ø—É—Å–∫)
5. [‚öôÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞](#Ô∏è-–ø–æ–¥–¥–µ—Ä–∂–∫–∞-—Å–µ—Ä–≤–µ—Ä–∞)
6. [‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã](#Ô∏è-—á–∞—Å—Ç—ã–µ-–≤–æ–ø—Ä–æ—Å—ã)
7. [ü§ù –ö–æ–º–∞–Ω–¥–∞](#-–∫–æ–º–∞–Ω–¥–∞)

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- [TypeScript](https://www.typescriptlang.org/) - –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫
- [Node.js](https://nodejs.org) - —Å—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è JavaScript
- [Yarn](https://yarnpkg.com/) - –ø–∞–∫–µ—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä
- [Nest.js](https://nestjs.com/) - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- [Prisma](https://www.prisma.io/) - ORM
- [Passport.js](https://www.prisma.io/) - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- [@nestjs/swagger](https://github.com/nestjs/swagger) - –º–æ–¥—É–ª—å –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ OpenAPI (Swagger) –≤ Nest.js
- [@itgorillaz/configify](https://github.com/it-gorillaz/configify) - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —É–ø—Ä–æ—â—ë–Ω–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞—Å—Å–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è Nest.js

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
## 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
git clone https://github.com/toastmanager/mpit_final_2024_backend.git
## 2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É —Å —Å–µ—Ä–≤–µ—Ä–æ–º:
cd mpit_final_2024_backend
## 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
yarn install
## 4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ .env.example –≤ .env:
cp .env.example .env
## 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:
yarn start
```

## üíª –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
## 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, s3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏ —Ç.–¥.)
docker compose -f docker-compose-dev up -d
## 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤)
yarn start:dev
```

## üîß –ó–∞–ø—É—Å–∫

1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `.env` —Ñ–∞–π–ª
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `Caddyfile.example` –≤ `Caddyfile`
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `Caddyfile` ([–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://caddyserver.com/docs/caddyfile))
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
   ```bash
   docker compose up -d --build backend
   ```
   - `-d` –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
   - `--build backend` —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é —Å–±–æ—Ä–∫—É —Å–µ—Ä–≤–µ—Ä–∞

## ‚öôÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### –ü–µ—Ä–µ–Ω–æ—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–í–æ–∑–º–æ–∂–Ω–æ, –≤–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ –¥—Ä—É–≥–æ–µ –º–µ—Å—Ç–æ. –ó–¥–µ—Å—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω —Å–ø–æ—Å–æ–± –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ–¥–Ω–æ–≥–æ postgres –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ docker-compose, –≤ –¥—Ä—É–≥–æ–π. –ù–æ –ø–æ —Ç–æ–º—É –∂–µ –ø—Ä–∏–Ω—Ü–∏–ø—É –º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ —ç–∫–∑–µ–º–ø–ª—è—Ä postgres –∑–∞–ø—É—â–µ–Ω–Ω–æ–º –Ω–µ –≤ docker-compose.

1. –°–æ–∑–¥–∞–π—Ç–µ dump —Ñ–∞–π–ª. –í –Ω—ë–º –±—É–¥—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –Ω—É–∂–Ω—ã–µ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
   ```bash
   docker compose exec db pg_dump -U username -F t dbname > dump.sql
   ```
2. –ü–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ `dump.sql` –≤ –ø–∞–ø–∫—É –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–æ–≤–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö.
3. –û—á–∏—Å—Ç–∏—Ç–µ –Ω–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É–¥–∞–ª—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–æ–≤–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è.**
   ```bash
   docker compose exec db dropdb 'dbname'
   docker compose exec db createdb 'dbname'
   ```
4. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –Ω–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏–∑ dump —Ñ–∞–π–ª–∞.
   ```bash
   docker compose exec -T db psql -U username dbname < dump.sql
   ```

## ‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### "Protobuf parsing error", –æ—à–∏–±–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å "onnx" –∏ —Ç.–¥.

–≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –∏–∑-–∑–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –º–æ–¥–µ–ª–∏ –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ, –Ω—É–∂–Ω–æ –ª–∏–±–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Å–∫–∞—á–∞—Ç—å –º–æ–¥–µ–ª—å —Å HuggingFace –∏ –≤—Å—Ç–∞–≤–∏—Ç—å –≤ `node_modules/@huggingface/transformers/.cache/sentence-transformers`, –ª–∏–±–æ —É–¥–∞–ª–∏—Ç—å –º–æ–¥–µ–ª—å –≤ —Ç–æ–π –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ –∑–∞–Ω–æ–≤–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ `yarn start` –∏–ª–∏ `yarn start:prod`.

## ü§ù –ö–æ–º–∞–Ω–¥–∞

| –§–∞–º–∏–ª–∏—è –ò–º—è      | –†–æ–ª—å        |
| ---------------- | ----------- |
| –õ–∞–ø—Ç–µ–≤–∞ –ú–∏–ª–∞–Ω–∞   | –ú–µ–Ω–µ–¥–∂–µ—Ä    |
| –ö–æ—Ä—è–∫–∏–Ω –í–ª–∞–¥–∏–º–∏—Ä | –î–∏–∑–∞–π–Ω–µ—Ä    |
| –ì–∞–±—ã—à–µ–≤ –ù–∏–∫–æ–ª–∞–π  | –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ |
